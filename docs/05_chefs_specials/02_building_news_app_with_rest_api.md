# ケーススタディ#5-2: REST APIでニュースアプリを作る

このケーススタディでは、世界中の開発者が利用している**公開REST API**と連携し、最新のニュース記事を取得して表示する、シンプルなニュースリーダーアプリを構築します。

このプロジェクトを通じて、あなたは以下の重要なスキルを学びます。

*   外部APIのドキュメントを読み解く方法。
*   APIから返ってくる複雑なJSONデータを、Dartのオブジェクトに変換（パース）する方法。
*   非同期で取得したデータを、きれいで分かりやすいリストとして表示する方法。

## 使用するAPI

今回は、開発者向けのニュースAPIとして有名な [**News API**](https://newsapi.org/) を使用します。
*   **特徴:** 無料で利用でき、APIキーを取得するだけで、世界中のニュースソースから最新記事を取得できます。
*   **事前準備:** [News APIのサイト](https://newsapi.org/register)でユーザー登録し、APIキーを取得しておいてください。

---

## Step 1: AIと共にAPI仕様を理解する

まず、作りたいものと、利用するAPIの情報をAIに伝え、開発の計画を立てます。

> **🤖 AI活用プロンプト (API仕様のインプットと設計相談)**
>
> あなたは、外部REST APIと連携するFlutterアプリの開発経験が豊富なシニアエンジニアです。
> これから、[News API](https://newsapi.org/) を使って、日本の技術系ニュースのトップヘッドラインを表示するアプリを作ります。
>
> **APIのエンドポイントとパラメータ:**
> - `https://newsapi.org/v2/top-headlines?country=jp&category=technology`
>
> **APIの応答JSON（一部抜粋）:**
> ```json
> {
>   "status": "ok",
>   "totalResults": 38,
>   "articles": [
>     {
>       "source": {
>         "id": "google-news-jp",
>         "name": "Google News (Japan)"
>       },
>       "author": "ITmedia",
>       "title": "〇〇が新しいAIモデルを発表 - ITmedia",
>       "description": "本日、〇〇は新しいAIモデル「...」を発表しました。これは、従来のモデルに比べて...",
>       "url": "https://www.example.com/article/123",
>       "urlToImage": "https://www.example.com/image/123.jpg",
>       "publishedAt": "2024-05-21T10:00:00Z",
>       "content": "本日、〇〇は新しいAIモデル「...」を発表しました。これは、従来のモデルに比べて..."
>     },
>     { ... }
>   ]
> }
> ```
>
> **質問:**
> 1.  このAPIの応答を元に、記事一件を表す`Article`モデルクラスと、その中の`Source`モデルクラスのDartコードを生成してください。`fromJson`ファクトリコンストラクタも実装してください。
> 2.  このアプリに必要な、**シンプルで分かりやすいディレクトリ構成**を提案してください。
> 3.  `pubspec.yaml`に追加すべき**主要なパッケージ**（http通信用、状態管理用など）をリストアップしてください。

このプロンプトにより、APIの複雑なJSON構造をパースするための、面倒なモデルクラスのコードをAIに自動生成させることができます。

---

## Step 2: APIクライアントの実装

次に、実際にNews APIにリクエストを送り、JSONデータを取得して`List<Article>`に変換する「APIクライアント」クラスを実装します。この定型的な非同期処理もAIに任せましょう。

> **🤖 AI活用プロンプト (APIクライアント生成)**
>
> `http`パッケージと、先ほど作成した`Article`モデルを使って、News APIから技術ニュースのトップヘッドラインを取得する`NewsApiClient`クラスを作成してください。
>
> **要件:**
> 1.  `fetchArticles()`という非同期メソッドを定義する。
> 2.  メソッド内で、APIエンドポイントにGETリクエストを送る。APIキーは`dart-define`で安全に渡すことを想定する。
> 3.  レスポンスが成功（ステータスコード200）した場合、JSONボディをデコードし、`articles`リストを`List<Article>`に変換して返す。
> 4.  通信が失敗した場合は、例外をスローする。

---

## Step 3: UIの構築とデータ表示

APIからデータを取得する準備が整ったので、それを表示するUIを構築します。このプロセスは、[前のケーススタディ](./01_building_chat_app_with_gemini.md)と非常によく似ています。

> **🤖 AI活用プロンプト (UIと状態管理)**
>
> `NewsApiClient`を使って記事リストを取得し、画面に表示するUIと状態管理のコードを、Riverpodの`FutureProvider`を使って実装してください。
>
> **要件:**
> 1.  `FutureProvider`を作成し、その中で`NewsApiClient.fetchArticles()`を呼び出す。
> 2.  UI側では、`FutureProvider`の状態（`data`, `loading`, `error`）を`when`句で監視する。
>     - **ローディング中:** 画面中央に`CircularProgressIndicator`を表示する。
>     - **エラー発生時:** エラーメッセージを表示する。
>     - **データ取得成功時:** `ListView.builder`を使って、取得した記事のリストを表示する。
> 3.  リストの各項目（記事一件）は、サムネイル画像、タイトル、ニュースソース名を表示するカスタムウィジェット（例: `ArticleTile`）として作成する。
> 4.  記事タイルをタップすると、`url_launcher`パッケージを使って、元の記事のURLをブラウザで開くようにする。

このプロンプトにより、非同期データの取得から、状態管理、UIへの反映、そして外部ブラウザとの連携まで、一連の複雑な実装をAIが体系的に生成してくれます。

---

## Step 4: 仕上げと改善

最後に、AIと対話しながら、アプリの使い勝手を向上させていきましょう。

*   **「リストを下に引っ張ったら、最新の記事を再取得する『Pull to Refresh』機能を実装して」**
    → `RefreshIndicator`ウィジェットの追加を提案してくれます。
*   **「記事の公開日時（`publishedAt`）がUTCなので、日本のタイムゾーンに変換して、'〇時間前'のような相対時間で表示したい」**
    → `intl`パッケージの使い方と、`DateTime`のフォーマット方法を教えてくれます。
*   **「画像の読み込みに失敗した場合、エラーアイコンを表示するように`ArticleTile`を修正して」**
    → `Image.network`の`errorBuilder`プロパティの使い方を提案してくれます。

このケーススタディを通じて、あなたはどんなREST APIが相手でも、仕様を理解し、データを取得し、美しいUIで表示するという、あらゆるアプリケーション開発の基礎となる強力なスキルを身につけることができます。